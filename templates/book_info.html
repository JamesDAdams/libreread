<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{.fileName}}</title>
	<link rel="icon" type="image/png" href="/static/img/favicon-16x16.png" sizes="16x16">
	<link rel="icon" type="image/png" href="/static/img/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/static/img/favicon-96x96.png" sizes="96x96">
	<link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
	<header>
		<div class="header-container">
			<a href="/" class="logo">
				<svg width="30" height="30" viewBox="290 230 280.089 340"><defs><style>.cls-1,.cls-2{fill:#676767;fill-rule:evenodd}.cls-2{fill:#fff}</style></defs><path id="Path_3" data-name="Path 3" class="cls-1" d="M281 140s-60 62.4-60 120c0 38.879 20 70 20 70 0 8.1-10 10-10 10-26.02-17.77-53.433-20.391-70-19.938a20 20 0 0 1-39.994 0c-16.57-.453-43.983 2.168-70 19.938 0 0-10-1.9-10-10 0 0 20-31.121 20-70C61 202.4 1 140 1 140a6.562 6.562 0 0 1 3.639-6.729c13.243-5.249 74.014-6.924 116.361 16.138v-14.784a39.979 39.979 0 0 1-.576-68.919C115.544 7.654 81 10 81 10V0c39.885 0 48.582 37.593 50.108 61.238a40.139 40.139 0 0 1 19.784 0C152.418 37.593 161.114 0 201 0v10s-34.544-2.346-39.424 55.706a39.979 39.979 0 0 1-.576 68.919v14.784c42.347-23.062 103.118-21.387 116.361-16.138A6.562 6.562 0 0 1 281 140z" transform="translate(289.044 230)"/><path id="Path_4" data-name="Path 4" class="cls-2" d="M241 170s-60 0-89.88 19.945L151 180c.014.268 20-20 89.989-20-.033.812.011 10 .011 10zm0-10h-.011c.003-.076.006-.084.011 0zM71 300s14.377-10 60-10v10s-30 0-60 10zm10-40l.081-9.986C121 250 131 260 131 260l-.134 9.875C111 260 80.976 261.495 81 260zm-20-50l.081-9.986C111 200 131 220 131 220l-.134 9.875C101 210 60.976 211.495 61 210zm-20-40s.044-9.188.011-10C111 160 130.986 180.268 131 180l-.12 9.945C101 170 41 170 41 170zm.011-10H41c0-.084.008-.076.011 0zm179.908 40.014L221 210c.024 1.495-40 0-69.866 19.875L151 220s20-20 69.919-19.986zm-20 50L201 260c.024 1.495-30 0-49.866 9.875L151 260s10-10 49.919-9.986zM211 310c-30-10-60-10-60-10v-10c45.623 0 60 10 60 10z" transform="translate(289.044 230)"/></svg>
				LibreRead <span>beta</span>
			</a>
			<div class="header-nav epub-nav">
				<a href="/" class="hn-download-nav">
					<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 48 48"><path d="M38 18h-8V6H18v12h-8l14 14 14-14zM10 36v4h28v-4H10z" class="nc-icon-wrapper" fill="#676767"/></svg>
					<label>Download book</label>
				</a>
				<a href="/" class="hn-edit-nav">
					<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 48 48"><path d="M6 34.5V42h7.5l22.13-22.13-7.5-7.5L6 34.5zm35.41-20.41c.78-.78.78-2.05 0-2.83l-4.67-4.67c-.78-.78-2.05-.78-2.83 0l-3.66 3.66 7.5 7.5 3.66-3.66z" class="nc-icon-wrapper" fill="#676767"/></svg>
					<label>Edit Metadata</label>
				</a>
				<a href="/" class="hn-delete-nav">
					<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 48 48"><path d="M12 38c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V14H12v24zm4.93-14.24l2.83-2.83L24 25.17l4.24-4.24 2.83 2.83L26.83 28l4.24 4.24-2.83 2.83L24 30.83l-4.24 4.24-2.83-2.83L21.17 28l-4.24-4.24zM31 8l-2-2H19l-2 2h-7v4h28V8z" class="nc-icon-wrapper" fill="#676767"/></svg>
					<label>Delete book</label>
				</a>
			</div>
		</div>
	</header>
	<div class="book-info-container">
		<div class="bic-fl">
			<img class="bic-cover" src="/uploads/the-clue/OEBPS/@public@vhost@g@gutenberg@html@files@54869@54869-h@images@cover.jpg" width="205">
		</div>
		<div class="bic-fr">
			<div class="bic-item title">
				<label>Title:</label>
				<div class="text">{{.info.VolumeInfo.Title}}</div>
			</div>
			<div class="bic-item subtitle">
				<label>Subtitle:</label>
				<div class="text">{{.info.VolumeInfo.Subtitle}}</div>
			</div>
			<div class="bic-item authors">
				<label>Authors:</label>
				<div class="text">{{.info.VolumeInfo.Authors}}</div>
			</div>
			<div class="bic-item publisher">
				<label>Publisher:</label>
				<div class="text">{{.info.VolumeInfo.Publisher}}</div>
			</div>
			<div class="bic-item published-date">
				<label>Published date:</label>
				<div class="text">{{.info.VolumeInfo.PublishedDate}}</div>
			</div>
			<div class="bic-item description">
				<label>Description:</label>
				<div class="text">{{.info.VolumeInfo.Description}}</div>
			</div>
			<div class="bic-item isbn-13">
				<label>ISBN_13:</label>
				<div class="text">{{(index .info.VolumeInfo.IndustryIdentifiers 0).Identifier}}</div>
			</div>
			<div class="bic-item isbn-10">
				<label>ISBN_10:</label>
				<div class="text">{{(index .info.VolumeInfo.IndustryIdentifiers 1).Identifier}}</div>
			</div>
			<div class="bic-item page-count">
				<label>Page count:</label>
				<div class="text">{{.info.VolumeInfo.PageCount}}</div>
			</div>
			<div class="bic-item categories">
				<label>Categories:</label>
				<div class="text">{{.info.VolumeInfo.Categories}}</div>
			</div>
			<div class="bic-item average-rating">
				<label>Average rating:</label>
				<div class="text">{{.info.VolumeInfo.AverageRating}}</div>
			</div>
			<div class="bic-item ratings-count">
				<label>Ratings count:</label>
				<div class="text">{{.info.VolumeInfo.RatingsCount}}</div>
			</div>
			<div class="bic-item image-link">
				<label>Image link:</label>
				<div class="text">{{.info.VolumeInfo.ImageLinks.Thumbnail}}</div>
			</div>
			<div class="bic-item language">
				<label>Language:</label>
				<div class="text">{{.info.VolumeInfo.Language}}</div>
			</div>
			<div class="bic-item reviews">
				{{.reviews}}
			</div>
		</div>
	</div>
	<div class="edit-metadata-wrapper">
		<div class="emw-close">Close</div>
		<div class="emw-dialog">
			<form enctype="multipart/form-data">
				<label>Book Metadata</label>
				<input type="text" name="filename" value="{{.fileName}}" style="display: none;">
				<input type="text" name="title" class="emwd-title">
				<input type="text" name="author" class="emwd-author">
				<img src="/" class="emwd-cover">
				<input type="file" name="cover" class="emwd-cover-upload" style="display: none;">
				<input type="button" class="secondary-button emwd-change-cover" value="Change image">
				<input type="submit" value="Save changes" class="emwd-submit">
			</form>
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"
  		integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  		crossorigin="anonymous"></script>
	<script type="text/javascript">
		$(function() {

			// Hide Header on on scroll down
			var didScroll;
			var lastScrollTop = 0;
			var delta = 5;
			var navbarHeight = $('header').outerHeight();

			$(window).scroll(function(event){
    			didScroll = true;
			});

			setInterval(function() {
    			if (didScroll) {
        			hasScrolled();
        			didScroll = false;
    			}
			}, 250);

			function hasScrolled() {
    			var st = $(this).scrollTop();
    
    			// Make sure they scroll more than delta
    			if(Math.abs(lastScrollTop - st) <= delta)
        			return;
    
    			// If they scrolled down and are past the navbar, add class .nav-up.
    			// This is necessary so you never see what is "behind" the navbar.
    			if (st > lastScrollTop && st > navbarHeight){
        			// Scroll Down
        			$('header').removeClass('nav-down').addClass('nav-up');
    			} else {
        			// Scroll Up
        			if(st + $(window).height() < $(document).height()) {
            			$('header').removeClass('nav-up').addClass('nav-down');
        			}
    			}
    
    			lastScrollTop = st;
			}

			$(document).on('click', '.hn-download-nav', function(e) {
      			e.preventDefault()
      			var fileName = window.location.pathname.split('/').pop();
				    var fileURL = "/uploads/" + fileName;
				    window.location.href = fileURL
      		})

      		$(document).on('click', '.hn-edit-nav', function(e) {
      			e.preventDefault()
      			window.scrollTo(0,0);
      			var fileName = window.location.pathname.split('/').pop();
      			var data = {
      				'fileName': fileName
      			}
				    $.ajax({
            		url: '/get-book-metadata',
            		type: 'GET',
            		data: data,
            		contentType: "application/json; charset=utf-8",
            		success: function (data) {
            			console.log(data)
            			$('.emwd-title').val(data.title)
            			$('.emwd-author').val(data.author)
            			$('.emwd-cover').attr('src', data.cover)
            			$('.edit-metadata-wrapper').show()
            		}
          		})
      		})

      		$(document).on('click', '.emw-close', function() {
      			$('.edit-metadata-wrapper').hide()
      		})

      		$(document).on('click', '.emwd-change-cover', function() {
      			$('.emwd-cover-upload').click()
      		})

      		function showCoverPreview(input) {
      			if (input.files && input.files[0]) {
        			var reader = new FileReader();

        			reader.onload = function (e) {
            			$('.emwd-cover').attr('src', e.target.result);
        			}

        			reader.readAsDataURL(input.files[0]);
    			}
      		}

      		$('.emwd-cover-upload').change(function() {
      			showCoverPreview(this)
      		})

      		$(document).on('click', '.emwd-submit', function(e) {
      			e.preventDefault()
      			var formData = new FormData($('.emw-dialog form')[0]);

      			$.ajax({
      				url: '/edit-book/{{.fileName}}',
        			type: 'POST',
        			data: formData,
        			success: function (data) {
            			alert(data)
            			$('.edit-metadata-wrapper').hide()
        			},
        			cache: false,
        			contentType: false,
        			processData: false
      			})
      		})
		})
	</script>
</body>
</html>